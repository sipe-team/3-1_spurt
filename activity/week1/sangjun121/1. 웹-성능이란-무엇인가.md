# 웹 성능이란 무엇인가? (사전지식)

가독성을 위해 해당 문서에 대한 노션 링크를 첨부합니다.
[노션 바로가기!](https://sangjunn.notion.site/12f976a7f2238152921ceb0698b1ca83?pvs=4)

🚨아래 사전지식은 웹 어플리케이션 자체의 성능을 넘어, 전체적인 시스템 성능의 관점에서 작성하였습니다.

## 웹 성능

MDN에서 기술한 웹 성능의 정의는 다음과 같습니다.

> 웹 성능은 객관적인 측정치이면서 로드 시간과 런타임을 어떻게 인식하는지에 대한 주관적인 사용자 경험을 의미한다.
> 
- 웹 성능은 객관적인 측정치와 사용자 경험에 의존한 주관적 추정치를 모두 포함합니다.
- 객관적 추정치에는 로딩 시간, 초당 프레임 수, 상호작용에 반응 할 수 있게 되기까지의 시간, 등이 있습니다.

### 웹 성능이 중요한 이유?

- 구글의 자료 조사에 따르면 페이지가 3초 안에 로딩되지 않으면, 53프로의 사용자가 떠나고 이탈률이 증가한다고 합니다. 서비스 운영시에 사용자의 경험은 매우 중요하기 때문에 웹성능을 개선하는 것은 매우 중요합니다.
<br>

## 성능 지표

### 개요

- 대표적인 성능의 지표는 **Latency(응답시간)** 와 **Throughput(처리량)** 이 있습니다.
- 이외 추가적인 지표도 추가적으로 기술 하였습니다.
- 서버 성능을 나타내는 지표는 다양하며 정답은 없습니다.
<br>

### Latency(응답시간)

- 시스템이 요청을 받고 응답할 때까지의 시간을 의미합니다.
    - 이는 네트워크 시간, 서버 및 서브 서비스의 시간, 등을 모두 포함
- 성능 평가 시에는 각 서브 시스템의 응답 시간의 총합을 중점으로 살펴봅니다.
- 응답시간은 서브시스템의 지연시간의 총합이 됩니다.
- Latency가 낮다 = 고속도로의 제한속도가 높아서 차가 빠르게 지나다닐 수 있다.

- 네트워크의 지연시간 간단 정리(참고)
    - 대개 성능 평가에 포함하는 서버 및 서브 시스템의 지연시간 외에, 네트워크 환경에서 발생하는 지연시간에 대해서도 간단하게 정리하였습니다.   
    ![latencymlw](https://github.com/user-attachments/assets/ba873369-7b8e-47df-9552-8cd99792c454)
  
    - 네트워크 연결 시간은 DNS조회, TCP 핸드셰이크, 보안 TLS 협상시간을 포함합니다.
    - **DNS resolution**: DNS Look up을 수행하는데 걸린 시간
        - DNS Look Up: 도메인 이름을 보고 해당 DNS서버에서 IP 주소 찾아 변환하는 프로세스
    - **Connecting:** TCP handshake를 완료하는데 걸린 시간
        - 각 종단 시스템 간의 TCP 연결을 초기에 수행하는데 걸리는 시간
    - **TSL handshake:** 보안 연결을 수립하는데 걸린 시간
    - **Sending:** HTTP 요청을 서버로 전송하는데 걸린 시간
    - **Receiving:** 자원을 다운로드 받는 데 걸린 시간
        - 해당 시간은 네트워크 용량과 자원 파일의 크기에 따라 결정된다.
        - 해당 자원에 대한 캐싱이 기존에 존재한다면, 해당 지연시간을 줄일 수 있다.
<br>

### Throughput(처리량)

- Throughput(처리량)은 작업자의 입장에서 시간당 얼마나 처리하는가(초당 처리하는 작업의 수)를 의미합니다.
- Throughput이 높다 = 도로가 넓어서 한번에 통과할 수 있는 차량의 수가 많다.
- Throughput의 측정 단위: RPS(Request Per Second)는 1초에 처리하는 HTTP 요청의 수

- 성능평가에서 처리량을 판단하는 방법
    
    <img width="647" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-11-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2 26 45" src="https://github.com/user-attachments/assets/4fbd9438-21d9-45c3-9cde-a91cfd468c9e">
    
    - 위의 시스템을 가정하다면, 다음과 같이 정리할 수 있습니다.
    - 하위 시스템 중 가장 낮은 처리량을 가지는 부분에 의해 전체 시스템의 처리량이 결정됩니다. 이와 같이, 하위 시스템 중 가장 낮은 처리량을 가지는 지점을 병목구간이라고 합니다.
    - 따라서, Throughput을 높이기 위해서는 서브 시스템 중 가장 처리량이 낮은 부분을 개선해야 합니다.
        - 위 그림에서는 Mysql
    - 서버 확장(Scale out)등 조치를 취하여 성능을 개선하고 병목구간을 해소하면, 병목구간이 이동하게 됩니다.
<br>

### Latency(응답시간)와 Throughput(처리량) 중 어떤 지표를 사용해야 할까?

- 상황에 따라 어떤 성능지표가 중요한지는 달라집니다.
    - 초당 1000건의 요청 처리 → Throughput이 중요
    - 모든 조회 요청을 1초 이내로 응답 → Latency가 중요
<br>

### 성능 측정을 기술하는 방법

- 성능 측정시 “몇 명의 사용자가 어느 정도의 밀도로 API를 요청할 때, 서버의 응답속도 분포는 ~하다.” 라는 형태로 작성하는 것이 적절합니다.
<br>

### 지표에 따른 성능 개선 방향성 정리

<img width="647" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-11-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3 39 36" src="https://github.com/user-attachments/assets/06c4692c-39e8-462a-8619-3105b9af9bc9">

- 병목 지점의 Throughput이 결국 전체 시스템의 Throughput이 되기 때문에, 서브 시스템에서 가장 처리량이 낮은 부분을 개선하는 것이 필요합니다
- 반면에, Latency는 서브 시스템의 지연시간의 총합이 되기 때문에, 가장 긴 부분부터 개선할 수 있는지 고민하는 과정이 필요합니다.
<br>
<br>

## 성능 개선하기

- 서비스의 상황에 맞게 평가에 사용할 적절한 지표를 고르고, 목표치를 선정해야 합니다.

### 1. 웹 성능 예산 설정하기

1. 정량기반지표 (Quantity Based Metrics)
    - 이미지, 스크립트, 폰트 등 웹페이지 제작에 필요한 요소들에 대한 한계 값을 지정합니다.
        - 주의! 단순히 DB 정규화와 같이, 파일 크기 및 개수를 줄인다고 해서 웹 성능이 개선되는건 아님
    - 브라우저(클라이언트)가 페이지 랜더링시 어떤 순서로 호출하는지, 레이지 레이아웃 설정 등 변수의 영향을 받습니다.
    
2. 시간기반지표 (Timing Based Metrics)
    - FCP(First Contentful Paint): DOM의 첫번째 비트를 표시하는 시점
    - TTI(Time to Interfactive): 페이지가 사용자 입력에 안정적으로 응답하는데 걸리는 시간
<br>

### 2. 서버의 성능을 개선하는 방법

1. 가장 기본적으로 서버의 대수를 늘리는 방식이 있습니다. 이를 Scale Out으로 통칭합니다.
    - 위의 예시 서브 시스템 상황과 같이, Nginx, nodejs, mongoDB로 서버를 배포한다고 가정해 봅시다.
    - 각 서브 시스템에 대해 어떤 서버를 증설해야 하는가에 대한 고민을 하였을 때, 밴치마킹 툴과 코드를 분석하면서 어느 부분이 Request를 처리하는 폭이 좁은가를 파악하고(처리량이 적은지), 해당 서브 시스템에 대해 서버를 증설하는 방향을 가져야 합니다.
    - 대표적으로 클라우드 서비스에서는, 서버의 상황에 따라 서버의 스펙을 상승시키고 줄이는 AWS의 **Auto Scaling 기술이 있습니다.**
    
2. 코드 효율화
    - Request를 얼마나 더 빠르게 처리할 수 있는가에 대한 개선 방향입니다.
    - 구체적인 예시: 비즈니스 로직 알고리즘 개선, 효율적인 쿼리작성을 진행하여, 어플리케이션에서 Request를 처리하는 시간을 줄입니다.
     
3. DB최적화
    - Index추가
    - Denormalization 테크닉 사용
        - Denormalization: 데이터베이스에서 성능 최적화를 위해 데이터를 의도적으로 정규화된 상태에서 일부 비정규화하는 기법
        - 일반적으로 정규화는 데이터의 중복을 줄이고 무결성을 유지하기 위해, 데이터를 여러 테이블로 나누는 과정입니다. 이를 반대로 비정규화하여 데이터를 중복하거나 테이블을 합쳐 쿼리의 성능을 향상 시킬 수 있습니다.
        - 중복된 데이터로 인해 저장공간과 무결성의 측면에서는 불리하지만, 조인 연산과 같은 조회 성능을 개선하여  성능향상을 기대할 수 있습니다.
<br>
<br>

## 참고 래퍼런스

[MDN Web Docs 웹성능](https://developer.mozilla.org/ko/docs/Web/Performance)   
[[10분 테코톡]베베, 허브의 성능 테스트](https://www.youtube.com/watch?v=3cTn53dtzJI&t=638s)   
[웹 개발자가 생각해야하는 웹 성능 최적화](https://ssdragon.tistory.com/131)
