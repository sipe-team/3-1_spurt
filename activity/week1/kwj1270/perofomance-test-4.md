# 성능테스트 설계

테스트 구간/시나리오 및 케이스, 제약조건, 테스트 수행 상세 절차를 기술한다.

시스템 분석을 통해 도출된 대상업무, 성능 목표를 기준으로 
시스템의 특성에 따른 테스트 시나리오를 선정하게 되는데 
On-Premise와 Cloud는 검증 항목이 다른 만큼 일부 다른 시나리오로 구성된다.

또한 설계 단계에서는 본격적인 성능 테스트 수행 준비 작업도 같이 진행하게 되는데, 
선정된 대상업무를 기준으로 `테스트 자동화 툴 Script를 작성`하고 
필요 시 기초 데이터 및 `테스트 데이터를 생성(또는 생성 요청)`하며 
부하 발생기(VM 혹은 노트북) 설치, 모니터링 자동화 툴 설치, 방화벽 해제 등 제반 환경을 구축해야한다.

# **1. 테스트 시나리오**

성능테스트용 시나리오는 시스템의 안정성, 응답성, 구간별 특성등을 감안하여 선정하게 되며, 
다음의 테스트 종류를 시스템 특성에 맞게 시나리오로 선정한다.

- Smoke Test: 시스템이 최소한의 부하에서도 적절하게 작동하는지 검증
- Average-Load Test: 예상되는 정상 조건에서 시스템이 어떻게 작동하는지 평가
- Stress Test: 부하가 예상 평균을 초과할 때 시스템이 한계에서 어떻게 작동하는지 평가
- Soak Test: 장기간에 걸쳐 시스템의 안정성과 성능을 평가
- Spike Test: 갑작스럽고 짧은 시간 동안 활동이 크게 증가하는 경우 시스템의 동작과 생존을 검증
- Breakpoint Test: 시스템의 용량 한계를 파악하기 위해 부하를 점진적으로 증가시킵니다.
- Volume Test: 대량의 데이터를 전송하여 네트워크등의 다양한 이슈를 파악하고 평가
- Fail-Over Test: 이중화된 서비스를 기준으로 정지/기동하였을 때 장애 내결함 및 부하분산 평가
- Auto-Scaling Test(Cloud 전용): POD 의 구성 목적과 서비스 기동 시간등을 감안하여 스케일 동작 평가
- Deployment Test(Cloud 전용): Cloud 의 무중단 배포를 위한 테스트 시나리오

## 1.1. Smoke Test

![image.png](/.asset/kwj1270/week1-26.png)
![image.png](/.asset/kwj1270/week1-27.png)

- 시스템의 최소 부하 상태에서 시스템이 잘 작동하는지 확인하고 기준 성능 값을 수집하기 위한 테스트
- 몇 VU로 테스트를 실행하는 것으로 구성되며, 5VU 이상은 미니 부하 테스트로 간주할 수 있다.
- 마찬가지로 테스트는 짧은 기간 동안 반복 횟수를 줄이거나 몇 초에서 최대 몇 분 동안 실행해야 한다.
    - 처리량을 적게 하고 기간을 짧게 유지
    - 테스트 스크립트를 적은 수의 VU(2~20개)가 반복하
    - 짧은 기간(30초~3분)으로 실행하도록 구성

## 1.2. Average-Load Test

![image.png](/.asset/kwj1270/week1-28.png)
![image.png](/.asset/kwj1270/week1-29.png)

- 예상되는 정상 조건(일반적인 부하)에서 시스템이 어떻게 작동하는지 평가하는 테스트 기법이다.
- 프로덕션 환경의 평균 동작을 반영하는 동시 사용자 수와 초당 요청 수를 시뮬레이션한다.
- 처리량 또는 VU를 점진적으로 증가시키고 일정 시간 동안 평균 부하를 유지한다.
    - 시스템 특성에 따라 테스트가 갑자기 중단되거나 짧은 감속 기간이 있을 수 있다.
    - 램프업 또는 최대 부하 기간 동안 조기 성능 저하 징후를 식별한다.
- 주요 검증항목
    - 응답시간
    - 시스템 자원(CPU, Memory, Disk 등)
    - 처리량(TPS, Throughput 등)

## 1.3. Stress Test

![image.png](/.asset/kwj1270/week1-30.png)
![image.png](/.asset/kwj1270/week1-31.png)

- 부하가 예상 평균을 초과할 때 시스템이 한계에서 어떻게 작동하는지 평가하는 테스트 기법
- 부하 패턴은 Average-Load Test 와 유사하지만, 더 높은 부하를 준다.
    - 더 높은 부하를 고려하기 위해 부하 증가에 비례하여 램프업 기간이 더 오래 걸린다.
    - 마찬가지로 테스트가 원하는 부하에 도달한 후에는 평균 부하 테스트보다 약간 더 오래 지속될 수 있다.
- 주요 검증항목
    - 병목구간 식별
    - 응답시간
    - 시스템 자원(CPU, Memory, Disk 등)
    - 처리량(TPS, Throughput 등)

## 1.4. Soak Test

![image.png](/.asset/kwj1270/week1-32.png)
![image.png](/.asset/kwj1270/week1-33.png)


- 장기간에 걸쳐 시스템의 안정성과 성능을 평가하는 테스트 기법
    - 장기간에 걸친 시스템 성능 저하 및 리소스 소비
    - 장시간 동안 시스템의 가용성과 안정성을 보장
- 최대 부하 기간(보통 평균)이 몇 시간, 심지어 며칠에 걸쳐 진행
- 기간은 상당히 길지만, 램프업 및 램프다운 기간은 평균 부하 테스트와 동일

## 1.5. Spike Test

![image.png](/.asset/kwj1270/week1-34.png)
![image.png](/.asset/kwj1270/week1-35.png)

- 갑작스럽고 짧은 시간 동안 활동이 크게 증가하는 경우 시스템의 동작과 생존을 검증하는 테스트 기법
- 시스템이 갑작스럽고 엄청난 트래픽 이벤트를 경험할 때 유용
    - 티켓 판매(테일러 스위프트),
    - 제품 출시(PS5),
    - 방송 광고(슈퍼볼),
    - 프로세스 마감일(세금 신고),
    - 시즌별 세일(블랙 프라이데이)
- 매우 짧거나 존재하지 않는 램프업 시간 동안 매우 높은 부하로 증가한다.
- 일반적으로 플래토 기간이 없거나 매우 짧다.
- 마찬가지로 램프다운은 매우 빠르거나 존재하지 않아 프로세스가 한 번만 반복
- 가끔씩, 이벤트 중에 수요가 많은 프로세스에 리소스를 허용하거나 우선순위를 정하기 위해 개편해야 함
- 주요 검증항목
    - Error 발생여부
    - 시스템 자원(CPU, Memory 등)

## 1.6. BreakPoint Test

![image.png](/.asset/kwj1270/week1-36.png)
![image.png](/.asset/kwj1270/week1-37.png)

- 시스템 한계를 찾는 것을 목표로 하는 테스트 기법
    - 시스템의 약점을 조정하거나 관리하여 더 높은 한계를 더 높은 수준으로 재배치
    - 이런 경우 교정 단계를 계획하고 시스템이 한계에 도달할 때를 대비하는 데 도움
    - 시스템이 어디서 어떻게 고장을 일으키는지 아는 것
- 중단점은 비현실적으로 높은 숫자로 증가
    - 일반적으로 임계값이 실패하기 시작하면 수동 또는 자동으로 중지해야 한다.
    - 이러한 문제가 나타나면 시스템이 한계에 도달한 것임을 파악한 것이므로

## 1.7. **Volume Test**

- 특정 양의 데이터로 응용프로그램이 정상 동작 하는지 검증 하기 위한  테스트 기법
- 대량의 데이터를 전송함으로 인해 발생할 수 있는 영향도 위주의 시나리오로 
많은 사용자가 노래 파일을 다운받거나 온라인 스트리밍 영상을 감상하거나 
대량의 데이터를 업로드 하는 방식으로 테스트를 수행한다.
- 주요 검증항목
    - 병목구간 식별
    - 데이터 손실 여부
    - 시스템 자원(CPU, Memory, Disk, Network Traffic 등)
    - 처리속도(TPS, Throughput 등)

## 1.8. **Fail-over Test**

![image.png](/.asset/kwj1270/week1-38.png)

- 이중화된 서비스를 기준으로 정지/기동하였을 때 장애 내결함 및 부하분산 평가 테스트 기법
- 이중화된 서비스를 대상으로 기준 부하를 부여한 상태에서 
서버를 순차적으로 정지/기동하였을 때 부하가 정상 분배되는지, Fail-over/back 되는지 여부를 검증한다.
- Fail-over는 장비 설치 단계에서 미리 단위 업무를 통해 정상 수행 여부를 검증하지만 
부하가 지속적으로 발생하는 실시간 부하 환경에서 확인하는 것이 더욱 정확하다.
- 주요 검증항목
    - Error 발생여부
    - Load Balancer의 Load-Balancing 적정성 검증
    - A서버 정지 시 B서버 정상 서비스 여부

## 1.9. **Auto-Scaling Test**

![image.png](/.asset/kwj1270/week1-39.png)

- Cloud의 주요한 기능인 Auto-scaling 기능 검증 및 설정 최적화를 위한 시나리오 테스트 기법
- POD의 구성 목적과 서비스 기동 시간등을 감안하여 
Scale-out/in 조건을 설정하여 Auto-scaling 기능을 검증합니다.
- `Stress Test` 시나리오도 이 테스트에서 검증이 가능하다.
- 주요 검증항목
    - Error 발생여부
    - Auto-scaling 기능
    - POD별 시스템 자원(CPU, Memory 등)

## 1.10 **Deployment Test**

![image.png](/.asset/kwj1270/week1-40.png)

- Cloud의 장점인 무중단 배포를 위한 테스트 기법
- Deployment 방식에 따라(Blue-green / Rolling) 배포로 인한 오류여부를 검증한다.
- 주요 검증항목
    - Error 발생여부
    - 무중단 배포 기능
    - POD별 시스템 자원(CPU, Memory 등)

---

# **2. 테스트 케이스**

테스트 시나리오별 상세 케이스를 작성한다.
케이스는 다음의 항목들을 감안하여 선정하되 필요한 경우 시나리오별 N개의 케이스가 작성될 수 있다.

- 고객 요구사항 파악
- 시나리오 수행 목적 및 목표 기술
- 부하 생성, 지속, 감소 방법
- 측정 항목 파악
- 케이스 별 테스트 구간 식별
- 점검 항목에 대한 예상결과 도출

## **1.3. 제약조건 확인**

테스트 환경 및 구성 특성을 감안하여 제약조건을 기술한다.
테스트는 실제 운영 환경의 부하 상황을 가정하여 목표를 세우고 
가상의 사용자를 통해 테스트를 수행하나 실 운영과는 부하량이 다를 수 있다.
아래의 항목들을 참고하여 제약조건을 확인한다.

- 테스트 환경
    - 자동화 툴에 의해 테스트가 진행되므로 시스템을 사용하는 사용자가 
    분산된 환경 하에서의 테스트를 재현할 수 없으므로 대상 서버의 성능만을 평가하게 되며, 
    네트워크의 특성에 의해 발생할 수 있는 응답시간의 지연 사항이 발생하지 않도록 조치하고 
    테스트를 수행합니다.
- 테스트 분석 및 자동화 툴
    - TO-BE 업무의 부하량 산정 기초 데이터가 충분하지 않아 가정된 조건에서 산정된 경우가 있으므로, 
    실제 운영 환경에서 발생하는 부하량과 테스트에서 산정한 부하량에 차이가 발생할 수 있다.
    - 테스트 대상 업무는 선정 기준에 따라 고객 및 프로젝트의 합의에 의해 선정되었고, 
    부하 테스트의 경우, 전체 업무 중 선정된 업무만을 대상으로 
    프로젝트에서 산정한 상대적 비율에 의거하여 테스트 부하를 분배한다.
    - 성능 테스트 도구에 의하여 측정되는 응답 시간은 Transaction 발생 후 
    Response로 오는 데이터가 Client의 해당 어플리케이션까지 도착하는데 걸린 시간으로 
    화면에 보여지는 시간(Presentation Time)은 제외된 응답 시간이다.
    - 향후 Open 이후 시스템의 결함을 
    효과적으로 측정하기 위하여 적정 수준의 Data가 서버에 Load 되어 있어야 한다.

## 1.4. **수행절차 정의**

각 시나리오/케이스의 순서와 수행 시간을 정하고 
시나리오별 필요 엔지니어와 세부 역할을 정의하여 
엔지니어의 불필요한 대기시간을 줄이고 관계 기관의 협조 시간을 미리 정의한다.